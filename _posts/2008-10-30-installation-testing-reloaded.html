---
layout: post
title: Installation testing reloaded
date: 2008-10-30 23:02:56.000000000 +01:00
type: post
published: true
status: publish
categories: []
tags:
- newsuse
- software
- suse
- yast
meta:
  posterous_6c96d52da40a5d7e34be538822acc826_post_id: '48645036'
  posterous_6c96d52da40a5d7e34be538822acc826_permalink: http://duncan.mac-vicar.com/installation-testing-reloaded
  _oembed_e786ecbae233e29096c24704af34d478: "{{unknown}}"
  _oembed_3722a34c9185747f8053125eec5c9a7c: "{{unknown}}"
  _oembed_33681fa9ad220621d89a9d6f6bc0f5cf: "{{unknown}}"
  _oembed_f1acece72ebd26a317b982965b3cecde: "{{unknown}}"
  _oembed_92e9ddd4e55a9996da9d195d1857512b: "{{unknown}}"
  _oembed_523a3223f1d35d9edbb465d61c46a903: "{{unknown}}"
  _oembed_c773e40b34c724fe0082ce15c195602d: "{{unknown}}"
  _oembed_56594c4964bbd3cb0af005876029aa63: "{{unknown}}"
  _oembed_9ca45d4b525f2d6e8305318c7ef89716: "{{unknown}}"
  _oembed_6f0a0466108e507fee1c070d4a59b39a: "{{unknown}}"
  _oembed_43d7bd6c57bac7ea52239c830bbca6cc: "{{unknown}}"
  _oembed_6f3fb1a79eb53af69a20bf9da83d1f09: "{{unknown}}"
  _oembed_51a7ac333f69ff61ec142be2c2745877: "{{unknown}}"
  _oembed_f2b67dc594b6d05536afda27a3eccfad: "{{unknown}}"
  _oembed_17b42c75dd165850f009fe640594b18f: "{{unknown}}"
author:
  login: duncan
  email: dmacvicar@gmail.com
  display_name: duncan
  first_name: Duncan
  last_name: Mac-Vicar P.
---
<p>
    ### Background</p>
<p>My colleagues use awesome tricks to do nfs boots with custom inst-sys and other magical procedures in order to test a modified installation. I find those tricks cool but that I tend to forget them after a few days.</p>
<p>During 11.0 release cycle, Coolo had to test the new installation theming. He explained me his method, using [update disks][1].</p>
<p>Update disks exist since longs time. AFAIK they were originally designed for drivers, but today they can insert almost any kind of file to the instsys. That was what coolo did: had his own tree, with an updated installation css theme, packed it, and then run qemu, passing the updatedisk url (which he served from his own machine) IIRC he passed an iso as a cdrom to qemu.</p>
<p>I find this method pretty cool. But I still had the feeling it could be automated more:</p>
<p>* qemu supports booting directly from a kernel and initrd, so I could use the http repositories and download those instead of needing a iso.<br />
* I could append kernel parameters telling qemu about them<br />
* I could automatically repack my local directory with updated files and avoid running mkcramfs by hand (latter [Steffen][3] told me I could even use cpio)<br />
* Why bothering with apache in my machine? As qemu can't access the driverdisk image from my local disk, I could start a embedded web server on demand and tell linuxrc about it.</p>
<p>So after lot of questions to Steffen and some code reading of Ludwig awesome "setupgrubfornfsinstall", here is the first version that works:</p>
<p>    git clone git://git.opensuse.org/people/dmacvicar/startinstall.git</p>
<p>### Usage</p>
<p>The structure of the driver update disk is something like this:</p>
<div class="CodeRay">
<div class="code">
<pre>./linux/suse/i386-11.0/dud.config
./linux/suse/i386-11.0/inst-sys
./linux/suse/i386-11.0/inst-sys/usr
./linux/suse/i386-11.0/inst-sys/usr/share
./linux/suse/i386-11.0/inst-sys/usr/share/YaST2
./linux/suse/i386-11.0/inst-sys/usr/share/YaST2/theme
./linux/suse/i386-11.0/inst-sys/usr/share/YaST2/theme/openSUSE
./linux/suse/i386-11.0/inst-sys/usr/share/YaST2/theme/openSUSE/wizard
./linux/suse/i386-11.0/inst-sys/usr/share/YaST2/theme/openSUSE/wizard/logo.png
./linux/suse/i386-11.0/inst-sys/usr/share/YaST2/theme/openSUSE/wizard/installation.qss</pre>
</div>
</div>
<p>In this case, I only want to replace the logo and css file. The important part is the directory with the architecture and version. dud.config has:</p>
<div class="CodeRay">
<div class="code">
<pre>UpdateName:     openSUSE 11.0 DUD
UpdateID:       193a399fca4b4da9
UpdatePriority: 100</pre>
</div>
</div>
<p>Which I guess are random values for our specific case ;-) This directory tree is available at /foo/driverupdate on my machine.</p>
<p>Now you need a http or ftp repository (I will add more features later...). In the example, it will be <a href="http://distros.foo.com/openSUSE-11.0-RC4-DVD/i386/DVD1">http://distros.foo.com/openSUSE-11.0-RC4-DVD/i386/DVD1</a></p>
<p>Now just run it:</p>
<div class="CodeRay">
<div class="code">
<pre>ruby startinstall.rb --tree /foo/driverupdate http://distros.foo.com/openSUSE-11.0-RC4-DVD/i386/DVD1</pre>
</div>
</div>
<p>startinstall.rb will download the kernel, initrd, pack the driverdisk, start a (webbrick based) webserver offering this driverdisk and launch qemu with the right parameters:</p>
<div class="CodeRay">
<div class="code">
<pre>qemu -kernel /tmp/kernel20081030-5149-1yn5upf-0
 -initrd /tmp/initrd20081030-5149-uquvmh-0
 -append
   &quot;install=http://distros.foo.com/openSUSE-11.0-RC4-DVD/i386/DVD1
    driverupdate=http://mymachine.suse.de:9999/updatedisk20081030-5149-ogaqpl-0 &quot;
 -hda /dev/zero
 -no-reboot
 -net nic,macaddr=00:BE:C3:B9:4C:BD,model=pcnet
 -m 666
 -net user
 -usb -usbdevice tablet</pre>
</div>
</div>
<p>After booting, you will see your modified (see the logo) installation:</p>
<p>![Screenshot](<a href="http://files.opensuse.org/opensuse/en/0/0a/Yast2-dud.png)">http://files.opensuse.org/opensuse/en/0/0a/Yast2-dud.png)</a></p>
<p>I will keep a small page for this tool [here][4].</p>
<p> [1]: <a href="http://ftp.suse.com/pub/people/hvogel/Update-Media-HOWTO/html/">http://ftp.suse.com/pub/people/hvogel/Update-Media-HOWTO/html/</a><br />
 [2]: <a href="http://en.opensuse.org/Linuxrc">http://en.opensuse.org/Linuxrc</a><br />
 [3]: <a href="http://lizards.opensuse.org/author/snwint/">http://lizards.opensuse.org/author/snwint/</a><br />
 [4]: <a href="http://files.opensuse.org/opensuse/en/0/0a/Yast2-dud.png">http://files.opensuse.org/opensuse/en/0/0a/Yast2-dud.png</a><br />
 [5]: <a href="http://en.opensuse.org/YaST/Development/Tools/StartInstall">http://en.opensuse.org/YaST/Development/Tools/StartInstall</a></p>
