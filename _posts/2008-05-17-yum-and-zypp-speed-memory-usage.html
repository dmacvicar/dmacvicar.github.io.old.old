---
layout: post
title: yum and ZYpp speed / memory usage
date: 2008-05-17 00:30:23.000000000 +02:00
type: post
published: true
status: publish
categories: []
tags:
- newsuse
- software
- suse
- yast
- yum
- zypp
meta:
  posterous_6c96d52da40a5d7e34be538822acc826_post_id: '48644658'
  posterous_6c96d52da40a5d7e34be538822acc826_permalink: http://duncan.mac-vicar.com/yum-and-zypp-speed-memory-usage
  _oembed_2c16b4d2daff5a1773b1ce0b49aa65a3: "{{unknown}}"
  _oembed_2ffa7de42c1bf6e4fcd0f9ee4ac1b4a2: "{{unknown}}"
  _oembed_d32c70c699e5a7d1ff329d76b82b08e3: "{{unknown}}"
  _oembed_13a1cb1f50f603189aabbc83a5f06cf3: "{{unknown}}"
  _oembed_9536626c134cee431ea38da038f4ad3c: "{{unknown}}"
  _oembed_78e4a3c4184beb09ea3520f35f41ce95: "{{unknown}}"
  _oembed_7327bada0cf6260e41ee58d59ca9a0dd: "{{unknown}}"
  _oembed_2639a5d7cec752bc0a7e9367793e832b: "{{unknown}}"
  _oembed_94ff0302a5582deca0ed83fe75feb392: "{{unknown}}"
  _oembed_9a1c23600507fdcb08fe39a817b64512: "{{unknown}}"
  twitter_cards_summary_img_size: a:7:{i:0;i:771;i:1;i:282;i:2;i:2;i:3;s:24:"width="771"
    height="282"";s:4:"bits";i:8;s:8:"channels";i:3;s:4:"mime";s:10:"image/jpeg";}
author:
  login: duncan
  email: dmacvicar@gmail.com
  display_name: duncan
  first_name: Duncan
  last_name: Mac-Vicar P.
---
<p>
    Michael Zucchi [complains][1] about yum memory usage, and points python as guilty.</p>
<p>&gt;Yum isn&rsquo;t so yummy after-all. Re-enabled python so i could run yum. Wow 120mb of vm to install a couple of packages. Not bad considering the box only has 128mb. This is crap.<br />
&gt;<br />
&gt;Hmm, should I try xubuntu - or will it be just as crappy and bloated and blighted by python poo?</p>
<p>Since our efforts to make the ZYpp really fast, by incorporating and integrating Michael Schroeder's sat solver together with Michael Matz's great work on the solv files and data storage, I never took the time to make a "quick comparison" on speed or memory usage. So lets have a quick look.</p>
<p>These are my repositories:</p>
<div class="CodeRay">
<div class="code">
<pre>Software configuration management (openSUSE_10.3)
10.3 - Main Repository (NON-OSS)
10.3 - Packman
openSUSE-10.3-Updates
Virtualization:VirtualBox
home:dgollub
KDE:KDE3
Mozilla based projects (openSUSE_10.3)
ZYPP SVN Builds (openSUSE_10.3)
ZYPP SVN Builds (openSUSE_10.3)
home:prusnak
10.3 - VideoLan
openSUSE.org tools (openSUSE_10.3)
SUSE Feature Tracking Tool (openSUSE_10.3)
psmt's Home Project (openSUSE_10.3)
openSUSE:10.3
Duncan Mac-Vicar SUSE rpms (openSUSE_10.3)
Latest YaST svn snapshots (openSUSE_10.3)
building/openSUSE_10.3</pre>
</div>
</div>
<p>All these repos together are about 41.000 packages.</p>
<p>What I did was to symlink ZYpp repositories to the yum repo path so they use the same repos.</p>
<div class="CodeRay">
<div class="code">
<pre># rm -rf /etc/yum.repos.d/
# ln -s /etc/zypp/repos.d /etc/yum.repos.d</pre>
</div>
</div>
<div style="text-decoration:line-through;">
*NOTE:* I tested with yum 3.2.4. I know 3.2.14 is available, but that is what I had installed when doing the test. After doing this tests I upgraded to 3.2.14 but it did not accept my .repo file because the character ":" in repo names. However the changelog of yum since 3.2.4 shows:</p>
<p>If using latest yum would invalidate this numbers (not as in 1 second, but as in an order of magnitude), let me know and I will repeat them when I make them work with my repo files.
</p></div>
<p>**Update 14.05.2008 : I did add yum 3.2.14. However it performed even worse, except for memory usage.**</p>
<p>**Update 15.05.2008 : added smart 0.52 numbers**</p>
<p>libzypp is the one you see in factory since some days: 4.21.1.</p>
<p>yum and ZYpp behave differently, as yum downloads and parses filelists.xml and other.xml which we ignore. There fore I skipped the download metadata part and just timed the cache building process.</p>
<div class="CodeRay">
<div class="code">
<pre># yum clean dbcache
...
19 sqlite files removed

# time yum makecache
...
Metadata Cache Created

real    9m41.036s
user    2m34.766s
sys     0m11.545s</pre>
</div>
</div>
<p>Almost 10 minutes. As this time includes parsing the two big files we ignore. I did it again, pressing Ctrl-C After yum finished with the primary data, which is what ZYpp uses:</p>
<div class="CodeRay">
<div class="code">
<pre># time yum makecache
...
Exiting on user cancel

real    4m6.730s
user    0m34.058s
sys     0m3.080s</pre>
</div>
</div>
<p>Now, zypper's turn:</p>
<div class="CodeRay">
<div class="code">
<pre># time zypper ref -B
...
All repositories have been refreshed.

real    0m18.472s
user    0m16.029s
sys     0m2.024s</pre>
</div>
</div>
<p>So yum takes 13 times the ZYpp needs technically (primary 1:1 comparison), but 30 times the time the end user sees.</p>
<p>Now, installing a package. Times were measured till the "continue? yes/no" prompt, or till the first interactive question.</p>
<div class="CodeRay">
<div class="code">
<pre># time yum install fate
...
Is this ok [y/N]: n
Exiting on user Command
Complete!

real    0m19.143s
user    0m14.057s
sys     0m1.920s</pre>
</div>
</div>
<p>zypper's turn:</p>
<div class="CodeRay">
<div class="code">
<pre># time zypper in fate
...
Continue? [YES/no]: n

real    0m9.796s
user    0m8.509s
sys     0m0.624s</pre>
</div>
</div>
<p>This time, ZYpp is only twice as fast as yum. Only ;-)</p>
<p>What happens when you want to upgrade your packages?</p>
<div class="CodeRay">
<div class="code">
<pre># time yum upgrade
...
real    0m45.152s
user    0m36.894s
sys     0m7.476s</pre>
</div>
</div>
<p>(Note: yum did not even found a solution here).</p>
<div class="CodeRay">
<div class="code">
<pre># time zypper update
...
Continue? [YES/no]: n

real    0m8.988s
user    0m7.820s
sys     0m0.596s</pre>
</div>
</div>
<p>yum needs 4 times the time ZYpp needs to calculate the upgrade.</p>
<p>**Update 14.05.2008 : I was comparing update to upgrade, I fixed those numbers in the chart. However, I don't have the update value for the old yum.**</p>
<p>Summary:</p>
<div class="p_embed p_image_embed">
<a href="http://duncan.files.wordpress.com/2008/05/media_httpspreadsheet_vgtuz-scaled1000.jpg"><img alt="Media_httpspreadsheet_vgtuz" height="183" src="{{ site.baseurl }}/assets/media_httpspreadsheet_vgtuz-scaled1000.jpg?w=300" width="500" /></a>
</div>
<p>Now, how much memory does each one need? For this, I just tested the install command with one package using valgrind massif, a heap profiler.</p>
<p>yum memory usage:</p>
<p>[![yum memory usage][2]][2]</p>
<p>ZYpp memory usage:</p>
<p>[![zypp memory usage][3]][3]</p>
<p>**Update 14.05.2008 : memory usage chart for yum 3.2.14**</p>
<p>[![yum 3.2.14 memory usage][4]][4]</p>
<p>**Update 15.05.2008 : memory usage chart for smart 0.52**</p>
<p>[![smart 0.52 memory usage][5]][5]</p>
<p>Here you can appreciate ZYpp goes a little bit over 20M, while yum goes over 180M, so yum uses about 9 times more memory. **Update 14.05.2008 : yum 3.2.14 uses around 160 in the worst point of time.**</p>
<div class="p_embed p_image_embed">
<img alt="Media_httpspreadsheet_iahnc" height="320" src="{{ site.baseurl }}/assets/media_httpspreadsheet_iahnc-scaled500.jpg?w=300" width="450" />
</div>
<p>I would be interested in tracking cpu usage too, but that will come later. What do you think about it?</p>
<p> [1]: <a href="http://blogs.gnome.org/zucchi/2008/05/10/linux-is-bloated/">http://blogs.gnome.org/zucchi/2008/05/10/linux-is-bloated/</a><br />
 [2]: <a href="http://files.opensuse.org/opensuse/en/e/ea/Yum-in-massif.png">http://files.opensuse.org/opensuse/en/e/ea/Yum-in-massif.png</a><br />
 [3]: <a href="http://files.opensuse.org/opensuse/en/6/65/Zypper-in-massif.png">http://files.opensuse.org/opensuse/en/6/65/Zypper-in-massif.png</a><br />
 [4]: <a href="http://files.opensuse.org/opensuse/en/2/26/Yum-3214-massif.png">http://files.opensuse.org/opensuse/en/2/26/Yum-3214-massif.png</a><br />
 [5]: <a href="http://files.opensuse.org/opensuse/en/f/fa/Smart-in-massif.png">http://files.opensuse.org/opensuse/en/f/fa/Smart-in-massif.png</a></p>
